<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Mapbox GL JS Example</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.css" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"/>
</head>
<body>
    <div id="map"></div>
    <button id="location-button" class="location-button">
        <i class="fa-solid fa-location-crosshairs"></i>
    </button>

    <script src="https://api.mapbox.com/mapbox-gl-js/v2.3.1/mapbox-gl.js"></script>
    <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.3/mapbox-gl-geocoder.min.js"></script>
    <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.3/mapbox-gl-geocoder.css" type="text/css">

    <script>
        mapboxgl.accessToken = 'pk.eyJ1Ijoiam9lY291dG8iLCJhIjoiY2xmcHN5NndpMGN0MDN4bmw1ZTQ3N2owNSJ9.Wm1TXO5LIzXcvRPVkLdXJQ';

        // Create a new map instance
        const map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/streets-v12',
            center: [-42.280395, -22.805185],
            zoom: 9.5
        });

        // remove layers de mapa não necessárias
        map.on('load', function() {
            map.removeLayer('road-label');
            map.removeLayer('poi-label');
        });

        // Adicionar barra de pesquisa
        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            marker: false, // Desabilita o marcador padrão da pesquisa
            placeholder: 'Pesquisar local', // Texto de placeholder para o campo de pesquisa
            language: 'pt-BR', // Define o idioma da pesquisa (opcional)
            countries: 'br', // Limita a pesquisa a resultados do Brasil (opcional)
            bbox: [-43.1796, -23.0814, -41.4308, -22.4582] // Define uma bounding box para limitar a área de pesquisa (opcional)
        });

        // Posiciona a barra de pesquisa no canto superior direito do mapa
        map.addControl(geocoder, 'top-right');

        // Adicionar funcionalidade ao botão de localização
        const locationButton = document.getElementById('location-button');
        locationButton.addEventListener('click', () => {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(position => {
                    const lngLat = [position.coords.longitude, position.coords.latitude];
                    map.flyTo({
                        center: lngLat,
                        zoom: 14
                    });
                });
            } else {
                alert('Geolocation is not supported by your browser.');
            }
        });

        // adicionar novos pontos ao mapa
        <?php require_once 'pontos.php'; ?>
    </script>
</body>
</html>
